# test-runner

## Clone The Operator Repositories

`test-runner` currently supports the following ways of cloning repositories in the `openshift` organization:

1. Clone all of the repositories concurrently in the `openshift` organization on GitHub that have `operator` in the name.

2. Clone only those operators passed into the program via `stdin`.  For example:
    ```bash
    $ ./test-runner <<< cloud-ingress-operator
    ```
    or:
    ```bash
    $ cat <<EOF | ./test-runner
    > openshift/cloud-ingress-operator
    > btoll/cloud-ingress-operator
    > openshift/must-gather-operator
    > openshift/ocm-agent-operator
    > EOF
    ```
    or:
    ```bash
    $ cat > repos.txt
    openshift/cloud-ingress-operator
    openshift/must-gather-operator
    btoll/ocm-agent-operator
    $ ./test-runner < repos.txt
    ```

> Note the format of `ORGANIZATION/REPOSITORY`.  This allows for cloning repositories that have the same name (usually, forks of the `upstream` project).

## Run The Tests

<!--
This can be done several ways, at least at the time of this writing.

- Unix `find` command
    + This will run the `find.sh` shell script for each repository in the `tests/` directory (generated by the `main.go` Golang program).
    + It will run the tests for every operator that contains an `test/e23` directory in the root of its repository.
    + This is very long-running and may not be ideal.
    ```bash
    $ find repos/ -maxdepth 3 -type d -ipath "*/test/e2e" -exec bash find.sh {} \;
    ```

- The `test_from_list.sh` shell script
    + This accepts a list of repositories.
    + The number inputs can be controlled.
-->

```bash
$ ./test-runner -runTests
```

The results of each test will be output as `json` and saved in the `tests/` directory by operator name, i.e.,  `tests/cluster-ingress-operator.json`.

## Generate The Report

After the repositories have been cloned and the tests have been run, there will be a `tests/` directory full of `json`-encoded test results.<!--  The `generate_report.sh` shell script will not iterate over this directory, outputting the name of the operator and the failing test(s), if any.-->

```bash
$ ./test-runner -generateReport
```

There will be no output from this command, and it will create the report in `./report.txt`.

## Podman

Build the image:

```bash
$ podman build -t test-runner .
```

Run the container, cloning all the repos to a local `repos/` directory:

```bash
$ podman run --rm -e GITHUB_TOKEN=$(< ~/github_token) -v $(pwd)/repos:/app/repos -it test-runner
````

## License

[GPLv3](COPYING)

## Author

[Benjamin Toll](https://benjamintoll.com)

